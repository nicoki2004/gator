# gator

A small CLI tool to manage and read RSS/Atom feeds locally. gator provides commands to register/login users, add feeds, follow/unfollow feeds, list feeds and aggregate articles. It uses PostgreSQL (with queries generated by `sqlc`) for persistence and a simple JSON config file in the user's home directory.

## Features

- Register and login local users
- Add RSS feeds and follow/unfollow them
- List feeds and followed feeds
- Aggregate and print feed items using a built-in RSS parser
- Uses `sqlc`-generated database access in `internal/database`

## Architecture

The project is a small CLI app written in Go. Key pieces:

- Command routing and handlers: top-level files such as `main.go` and `handler_*.go`
- Configuration: `internal/config/config.go` (uses `~/.gatorconfig.json`)
- Database models/queries: generated code in `internal/database` (sqlc)
- RSS fetching/parsing: `internal/rss/rss_feed.go`

## Requirements

- Go 1.20+ (or current stable Go)
- PostgreSQL
- `sqlc` (only required if you want to regenerate DB code)

## Install / Build

1. Clone the repo:

```sh
git clone https://github.com/<your-user>/gator.git
cd gator
```

2. Build the binary:

```sh
go build -o gator .
```

3. (Optional) Regenerate database code if you changed SQL and have `sqlc` installed:

```sh
sqlc generate
```

## Database setup

Create a PostgreSQL database and run the schema SQL files in order. Example using `psql`:

```sh
# create DB (replace values as needed)
createdb gator

# run migrations (from repo root)
psql -d gator -f sql/schema/001_users.sql
psql -d gator -f sql/schema/002_feeds.sql
psql -d gator -f sql/schema/003_feed_follows.sql
```

Alternatively run all schema files in a loop:

```sh
for f in sql/schema/*.sql; do psql -d gator -f "$f"; done
```

## Configuration

gator reads configuration from a JSON file in the user's home directory called `.gatorconfig.json`.

Example `~/.gatorconfig.json`:

```json
{
	"db_url": "postgres://user:password@localhost:5432/gator?sslmode=disable",
	"current_user_name": ""
}
```

The `db_url` is used to connect to PostgreSQL. The `current_user_name` is updated when you `login`.

## Usage

Run the built binary followed by a command. Basic commands available:

- `register <name>` — create a new local user
- `login <name>` — set the current active user (updates `~/.gatorconfig.json`)
- `reset` — reset state (see code)
- `users` — list users
- `agg` — aggregate articles from followed feeds
- `addfeed <name> <url>` — add a new feed (requires being logged in)
- `feeds` — list all feeds
- `follow <url>` — follow a feed by URL (requires being logged in)
- `following` — list feeds the current user follows
- `unfollow <url>` — unfollow a feed (requires being logged in)

Examples:

```sh
./gator register alice
./gator login alice
./gator addfeed "Hacker News" https://news.ycombinator.com/rss
./gator follow https://news.ycombinator.com/rss
./gator feeds
```

Note: commands that modify user-specific data require you to be logged in. The `login` command updates `current_user_name` in your config.

## Development notes

- RSS fetching/parsing: [internal/rss/rss_feed.go](internal/rss/rss_feed.go)
- Config management: [internal/config/config.go](internal/config/config.go)
- SQL schema: `sql/schema/*.sql`
- Generated DB models/queries: [internal/database](internal/database)

If you change SQL files, run `sqlc generate` to refresh `internal/database`.

## Contributing

Contributions are welcome. Open an issue or submit a pull request with changes and tests where appropriate.

## License

This repository does not include a license file. Add a `LICENSE` if you want an explicit license.

## Follow-ups

- Add unit and integration tests for handlers and database queries.
- Add a `Dockerfile` and `docker-compose.yml` for easy local development (Postgres + gator).
- Add CLI `--help` output and argument validation for all commands.
- Add support for Atom feeds and improved feed content parsing.
- Add caching and rate-limiting for feed fetching.
- Add CI (GitHub Actions) to run `go test` and `sqlc generate` checks.
- Add a `LICENSE` file (MIT/Apache/BSD) if you want to allow contributions.

## Model Graph

Below is a simple Entity Relationship diagram (Mermaid) showing the primary models and relations used by the application.

```mermaid
erDiagram
		USERS ||--o{ FEEDS : owns
		USERS ||--o{ FEED_FOLLOWS : follows
		FEEDS ||--o{ FEED_FOLLOWS : followed_by

		USERS {
			uuid id PK
			timestamp created_at
			timestamp updated_at
			string name
		}
		FEEDS {
			uuid id PK
			timestamp created_at
			timestamp updated_at
			string name
			string url
			uuid user_id FK
		}
		FEED_FOLLOWS {
			uuid id PK
			timestamp created_at
			timestamp updated_at
			uuid user_id FK
			uuid feed_id FK
		}
```

The models mirror the generated types in `internal/database`:

- `User` — stores user metadata
- `Feed` — a feed added by a user
- `FeedFollow` — join table linking users to feeds they follow

